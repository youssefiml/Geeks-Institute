{% extends "base.html" %}

{% block title %}Statistics - Music Library{% endblock %}

{% block content %}
<div class="fade-in">
    <!-- Header -->
    <div class="text-center mb-8">
        <h2 class="text-4xl font-bold text-white mb-2">Music Library Statistics</h2>
        <p class="text-gray-300">Insights and analytics about your collection</p>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Albums -->
        <div class="bg-gradient-to-r from-purple-600/30 to-purple-700/30 rounded-lg p-6 border border-purple-500/50">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-purple-200 text-sm font-medium">Total Albums</p>
                    <p class="text-3xl font-bold text-white">{{ stats.total_albums }}</p>
                </div>
                <i class="fas fa-compact-disc text-3xl text-purple-300"></i>
            </div>
        </div>

        <!-- Total Artists -->
        <div class="bg-gradient-to-r from-blue-600/30 to-blue-700/30 rounded-lg p-6 border border-blue-500/50">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-blue-200 text-sm font-medium">Total Artists</p>
                    <p class="text-3xl font-bold text-white">{{ stats.total_artists }}</p>
                </div>
                <i class="fas fa-users text-3xl text-blue-300"></i>
            </div>
        </div>

        <!-- Total Genres -->
        <div class="bg-gradient-to-r from-green-600/30 to-green-700/30 rounded-lg p-6 border border-green-500/50">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-green-200 text-sm font-medium">Genres</p>
                    <p class="text-3xl font-bold text-white">{{ stats.total_genres }}</p>
                </div>
                <i class="fas fa-music text-3xl text-green-300"></i>
            </div>
        </div>

        <!-- Average Albums per Artist -->
        <div class="bg-gradient-to-r from-orange-600/30 to-orange-700/30 rounded-lg p-6 border border-orange-500/50">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-orange-200 text-sm font-medium">Avg Albums/Artist</p>
                    <p class="text-3xl font-bold text-white">{{ stats.avg_albums_per_artist or '0' }}</p>
                </div>
                <i class="fas fa-chart-line text-3xl text-orange-300"></i>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Genre Distribution Chart -->
        <div class="bg-white/10 rounded-lg p-6 border border-white/20 backdrop-blur-sm">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <i class="fas fa-chart-pie mr-2 text-purple-400"></i>Albums by Genre
            </h3>
            <div class="h-64 flex items-center justify-center">
                <canvas id="genreChart"></canvas>
            </div>
        </div>

        <!-- Release Year Chart -->
        <div class="bg-white/10 rounded-lg p-6 border border-white/20 backdrop-blur-sm">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <i class="fas fa-chart-bar mr-2 text-blue-400"></i>Albums by Release Year
            </h3>
            <div class="h-64 flex items-center justify-center">
                <canvas id="yearChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Additional Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Recent Activity -->
        <div class="bg-white/10 rounded-lg p-6 border border-white/20 backdrop-blur-sm">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <i class="fas fa-clock mr-2 text-green-400"></i>Latest Addition
            </h3>
            {% if stats.most_recent_album %}
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="text-white font-medium">{{ stats.most_recent_album.title }}</div>
                    <div class="text-gray-400 text-sm">Released {{ stats.most_recent_album.release_year }}</div>
                </div>
            {% else %}
                <div class="text-gray-400 text-center py-8">
                    <i class="fas fa-inbox text-3xl mb-2"></i>
                    <p>No albums added yet</p>
                </div>
            {% endif %}
        </div>

        <!-- Oldest Album -->
        <div class="bg-white/10 rounded-lg p-6 border border-white/20 backdrop-blur-sm">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                <i class="fas fa-history mr-2 text-yellow-400"></i>Oldest Album
            </h3>
            {% if stats.oldest_album %}
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="text-white font-medium">{{ stats.oldest_album.title }}</div>
                    <div class="text-gray-400 text-sm">Released {{ stats.oldest_album.release_year }}</div>
                    <div class="text-xs text-gray-500 mt-1">{{ 2024 - stats.oldest_album.release_year }} years old</div>
                </div>
            {% else %}
                <div class="text-gray-400 text-center py-8">
                    <i class="fas fa-inbox text-3xl mb-2"></i>
                    <p>No albums in collection</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white/5 rounded-lg p-6 border border-white/10">
        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
            <i class="fas fa-rocket mr-2 text-red-400"></i>Quick Actions
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <a href="{{ url_for('create_album') }}" 
               class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg text-center transition-colors group">
                <i class="fas fa-plus text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                <div class="font-medium">Add Album</div>
                <div class="text-sm opacity-75">Expand your collection</div>
            </a>

            <a href="{{ url_for('create_artist') }}" 
               class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg text-center transition-colors group">
                <i class="fas fa-user-plus text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                <div class="font-medium">Add Artist</div>
                <div class="text-sm opacity-75">New musicians</div>
            </a>

            <a href="{{ url_for('index') }}" 
               class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg text-center transition-colors group">
                <i class="fas fa-search text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                <div class="font-medium">Browse Albums</div>
                <div class="text-sm opacity-75">Explore your library</div>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fetch and display genre chart
    fetch('/api/stats/genres')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('genreChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(item => item.genre),
                    datasets: [{
                        data: data.map(item => item.count),
                        backgroundColor: [
                            '#8B5CF6', '#3B82F6', '#10B981', '#F59E0B',
                            '#EF4444', '#EC4899', '#6366F1', '#84CC16',
                            '#06B6D4', '#F97316', '#8B5A2B', '#6B7280'
                        ],
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ffffff',
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Error loading genre chart:', error);
            document.getElementById('genreChart').style.display = 'none';
        });

    // Fetch and display year chart
    fetch('/api/stats/years')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('yearChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.release_year),
                    datasets: [{
                        label: 'Albums',
                        data: data.map(item => item.count),
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#ffffff',
                                stepSize: 1
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        })
        .catch(error => {
            console.error('Error loading year chart:', error);
            document.getElementById('yearChart').style.display = 'none';
        });

    // Add animation to metric cards
    const cards = document.querySelectorAll('.grid > div');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}